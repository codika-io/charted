---
interface Props {
  headings: { slug: string; text: string; depth: number }[];
}

const { headings: _ } = Astro.props;
---

<aside class="hidden lg:block">
  <div class="section-ruler sticky top-8" aria-label="Page sections">
    <div class="font-mono text-[11px] text-surface-300 tabular-nums flex items-center gap-2">
      <span data-scroll-progress>0.00</span>
      <span class="ruler-progress-line h-[2px] bg-accent-500 transition-all duration-300" style="width: 0;"></span>
    </div>
  </div>
</aside>

<script>
  function initProgress() {
    const progressEl = document.querySelector('[data-scroll-progress]');
    const progressLine = document.querySelector<HTMLElement>('.ruler-progress-line');
    if (!progressEl && !progressLine) return;

    let ticking = false;

    function update() {
      const scrollY = window.scrollY;
      const docHeight = document.documentElement.scrollHeight - window.innerHeight;
      const progress = docHeight > 0 ? scrollY / docHeight : 0;

      if (progressEl) {
        progressEl.textContent = progress.toFixed(2);
        if (progress > 0) {
          progressEl.classList.remove('text-surface-300');
          progressEl.classList.add('text-accent-500');
        } else {
          progressEl.classList.add('text-surface-300');
          progressEl.classList.remove('text-accent-500');
        }
      }
      if (progressLine) {
        progressLine.style.width = `${Math.round(progress * 24)}px`;
      }

      ticking = false;
    }

    function onScroll() {
      if (!ticking) {
        requestAnimationFrame(update);
        ticking = true;
      }
    }

    window.addEventListener('scroll', onScroll, { passive: true });
    update();
  }

  initProgress();
  document.addEventListener('astro:after-swap', initProgress);
</script>
